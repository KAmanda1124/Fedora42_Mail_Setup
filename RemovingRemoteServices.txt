#!/bin/bash

# Services: sshd, telnet, rsh, rsync, cockpit

echo "========================================="
echo "     Stopping Remote Access Services"
echo "========================================="

# Must run as root
if [ "$(id -u)' -ne 0 ]; then
	echo "Must be ran as root"
	exit 1
fi

echo "Stopping Remote Services" 
systemctl stop sshd 2>/dev/null
systemctl stop telnet.socket 2>/dev/null
systemctl stop rsh.socket 2>/dev/null
systemctl stop rsyncd 2>/dev/null
systemctl stop cockpit.socket 2>/dev/null
systemctl stop cockpit 2>/dev/null

echo "Disabling Remote Services"
systemctl disable sshd 2>/dev/null
systemctl disable telnet.socket 2>/dev/null
systemctl disable rsh.socket 2>/dev/null
systemctl disable rsyncd 2>/dev/null
systemctl disable cockpit.socket 2>/dev/null
systemctl disable cockpit 2>/dev/null

echo "Masking Services"
# Doesn't allow service to manually or automatically started
systemctl mask sshd 2>/dev/null
systemctl mask telnet.socket 2>/dev/null
systemctl mask rsh.socket 2>/dev/null
systemctl mask rsyncd 2>/dev/null
systemctl mask cockpit.socket 2>/dev/null
systemctl mask cockpit 2>/dev/null

echo "Removing Remote Services"
dnf -y remove openssh-server telnet-server rsh-server rsync cockpit
dnf -y autoremove

echo "Verification check:"
for svc in sshd rsyncd cockpit; do
	if systemctl is-active --quiet $svc; then
		echo "$svc is still active"
	else
		echo "$svc is inactive/removed"
	fi
done



echo "Finished stopping unwanted services"